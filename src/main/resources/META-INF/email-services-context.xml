<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:int="http://www.springframework.org/schema/integration"
       xsi:schemaLocation="http://www.springframework.org/schema/integration
	    http://www.springframework.org/schema/integration/spring-integration-3.0.xsd
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-4.0.xsd">
		
	<int:gateway id="emailServicesGateway" service-interface="com.bolehunt.gene.gateway.EmailServiceGateway" default-reply-timeout="3000">
        <int:method name="sendVerificationToken" request-channel="emailVerificationRouterChannel" request-timeout="3000"/>
    </int:gateway>
    	
    <int:channel id="emailVerificationRouterChannel">
        <int:queue capacity="10" message-store="emailVerificationMessageStore"/>
    </int:channel>
         
    <int:router id="emailVerificationRouter" input-channel="emailVerificationRouterChannel" expression="payload.getTokenType()">
        <int:poller fixed-rate="20">
            <int:transactional/>
        </int:poller>
        <int:mapping value="1" channel="emailVerificationTokenSendChannel"/>
        <int:mapping value="2" channel="emailRegistrationTokenSendChannel"/>
        <int:mapping value="3" channel="emailLostPasswordTokenSendChannel"/>
    </int:router>

    <int:channel id="emailVerificationTokenSendChannel"/>
    <int:service-activator id="emailVerficationMailSenderService" input-channel="emailVerificationTokenSendChannel"
                           output-channel="nullChannel" ref="mailSenderService"
                           method="sendVerificationEmail">
    </int:service-activator>
    
    <int:channel id="emailRegistrationTokenSendChannel"/>
    <int:service-activator id="emailRegistrationMailSenderService" input-channel="emailRegistrationTokenSendChannel"
                           output-channel="nullChannel" ref="mailSenderService"
                           method="sendRegistrationEmail">
    </int:service-activator>

    <int:channel id="emailLostPasswordTokenSendChannel"/>
    <int:service-activator id="emailLostPasswordSenderService" input-channel="emailLostPasswordTokenSendChannel"
                           output-channel="nullChannel" ref="mailSenderService"
                           method="sendLostPasswordEmail">
    </int:service-activator>
    
    <bean id="emailVerificationMessageStore" class="org.springframework.integration.store.SimpleMessageStore"/>

	<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="host" value="smtp.gmail.com" />
		<property name="port" value="465" />
		<property name="protocol" value="smtp" />
		<property name="username" value="stephanie.capricorn@gmail.com" />
		<property name="password" value="20070625" />
	 
		<property name="javaMailProperties">
			<props>
	           	<prop key="mail.smtp.auth">true</prop>
	           	<prop key="mail.smtp.starttls.enable">false</prop>
	           	<prop key="mail.smtp.quitwait">false</prop>
	           	<prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop>
                <prop key="mail.smtp.socketFactory.fallback">false</prop>
                <prop key="mail.debug">false</prop>
	       	</props>
		</property>
	</bean>
	
	<bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
    	<property name="resourceLoaderPath" value="/WEB-INF/velocity"/>
	</bean>

</beans>